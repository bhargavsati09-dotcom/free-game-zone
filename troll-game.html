<!DOCTYPE html>
<html>
<head>
  <title>Time Traveller Troll Game</title>
  <style>
    body { margin:0; overflow:hidden; background:black; color:white; font-family:Arial; }
    canvas { display:block; }
  </style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* FULLSCREEN */
function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* GAME STATE */
let deaths = 0;
let firstDeath = false;
let laughTimer = 0;
let startTime = Date.now();

/* PLAYER */
let player = { x:120, y:0, w:30, h:40, vx:0, vy:0 };
const gravity = 0.7;
const jumpPower = -14;

function resetPlayer(){
  player.x = 120;
  player.y = canvas.height - 220;   // SAFE spawn (above first platform)
  player.vx = 0;
  player.vy = 0;
}
resetPlayer();

/* INPUT */
let keys = {};
addEventListener("keydown", e=>keys[e.key]=true);
addEventListener("keyup", e=>keys[e.key]=false);

/* PLATFORMS */
let platforms = [
  {x:80,  y:canvas.height-160, w:160, h:16},
  {x:320, y:canvas.height-240, w:140, h:16},
  {x:560, y:canvas.height-320, w:140, h:16},
];

/* SECRET APPEAR PLATFORM */
let secretPlatform = {
  x:760,
  y:canvas.height-400,
  w:140,
  h:16,
  visible:false
};

/* MOVING LASER (SAFE HEIGHT) */
let laser = {
  x:200,
  y:canvas.height-120,
  w:180,
  h:6,
  dir:1
};

/* KILLING STARS */
let stars = [
  {x:400, y:canvas.height-260, r:12},
  {x:650, y:canvas.height-340, r:12}
];

/* PORTAL */
let portal = {x:980, y:canvas.height-470, w:60, h:90};

/* COLLISION */
function hit(a,b){
  return a.x < b.x+b.w &&
         a.x+a.w > b.x &&
         a.y < b.y+b.h &&
         a.y+a.h > b.y;
}

function onGround(){
  let test = {...player, y:player.y+1};
  return [...platforms, secretPlatform]
    .filter(p=>p.visible!==false)
    .some(p=>hit(test,p));
}

/* DIE */
function die(){
  deaths++;
  laughTimer = 50;
  firstDeath = true;
  resetPlayer();
}

/* UPDATE */
function update(){

  /* movement */
  player.vx = 0;
  if(keys["ArrowLeft"]) player.vx = -5;
  if(keys["ArrowRight"]) player.vx = 5;
  if(keys["ArrowUp"] && onGround()) player.vy = jumpPower;

  player.vy += gravity;

  /* horizontal */
  player.x += player.vx;
  [...platforms, secretPlatform].forEach(p=>{
    if(p.visible===false) return;
    if(hit(player,p)){
      if(player.vx>0) player.x = p.x-player.w;
      if(player.vx<0) player.x = p.x+p.w;
    }
  });

  /* vertical */
  player.y += player.vy;
  [...platforms, secretPlatform].forEach(p=>{
    if(p.visible===false) return;
    if(hit(player,p)){
      if(player.vy>0){ player.y = p.y-player.h; player.vy=0; }
      if(player.vy<0){ player.y = p.y+p.h; player.vy=0; }
    }
  });

  /* SECRET PLATFORM APPEAR */
  if(!secretPlatform.visible && player.x > 700){
    secretPlatform.visible = true;
  }

  /* MOVING LASER */
  laser.x += 3 * laser.dir;
  if(laser.x < 150 || laser.x > 500) laser.dir *= -1;

  if(hit(player, laser)) die();

  /* STAR KILL */
  stars.forEach(s=>{
    let dx = player.x+15 - s.x;
    let dy = player.y+20 - s.y;
    if(Math.sqrt(dx*dx + dy*dy) < s.r + 10) die();
  });

  /* FALL */
  if(player.y > canvas.height) die();

  /* PORTAL WIN */
  if(hit(player, portal)){
    alert("YOU ESCAPED ðŸ˜ˆ");
    location.reload();
  }

  if(laughTimer>0) laughTimer--;
}

/* DRAW FACE */
function drawFace(){
  let x = canvas.width - 180;
  let y = 120;
  let laughing = laughTimer > 0;

  ctx.strokeStyle = "red";
  ctx.lineWidth = 3;

  /* eyes */
  if(laughing){
    ctx.beginPath();
    ctx.moveTo(x-30,y); ctx.lineTo(x-10,y-5);
    ctx.moveTo(x+10,y-5); ctx.lineTo(x+30,y);
    ctx.stroke();
  }else{
    ctx.strokeRect(x-30,y-10,20,10);
    ctx.strokeRect(x+10,y-10,20,10);
  }

  /* mouth */
  ctx.beginPath();
  ctx.arc(x,y+20,20,laughing?0:Math.PI,laughing?Math.PI:0);
  ctx.stroke();

  ctx.fillStyle="white";
  ctx.font="18px Arial";

  if(!firstDeath){
    ctx.fillText("Just a simple space person game", x-140, y+60);
  } else if(deaths === 1){
    ctx.fillText("Nah, it is not that much simple but you can do it", x-200, y+60);
  }
}

/* DRAW */
function draw(){

  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* platforms */
  ctx.fillStyle="#00d4ff";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  if(secretPlatform.visible){
    ctx.fillStyle="#c77dff";   // light purple âœ”
    ctx.fillRect(secretPlatform.x,secretPlatform.y,secretPlatform.w,secretPlatform.h);
  }

  /* laser */
  ctx.fillStyle="red";
  ctx.fillRect(laser.x, laser.y, laser.w, laser.h);

  /* stars */
  ctx.fillStyle="yellow";
  stars.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    ctx.fill();
  });

  /* portal */
  ctx.fillStyle="violet";
  ctx.fillRect(portal.x, portal.y, portal.w, portal.h);

  /* player */
  ctx.fillStyle="#06d6a0";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  drawFace();

  /* UI */
  ctx.fillStyle="white";
  ctx.fillText("Deaths: "+deaths, 20,30);
  ctx.fillText("Time: "+((Date.now()-startTime)/1000).toFixed(1), 20,55);
}

/* LOOP */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
