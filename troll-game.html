<!DOCTYPE html>
<html>
<head>
  <title>Time Traveller Troll Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      color: white;
      font-family: Arial;
      text-align: center;
    }
    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 18px;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>

<div id="ui">
  Level: <span id="level">1</span> |
  Deaths: <span id="deaths">0</span> |
  Time: <span id="time">0.0</span>s
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

let level = 1;
let deaths = 0;
let startTime = Date.now();
let win = false;

let player = { x: 80, y: 0, w: 24, h: 30, vy: 0, onGround: false };

let gravity = 0.7;
let jumpPower = -15;

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function resetPlayer() {
  player.x = 80;
  player.y = canvas.height - 120;
  player.vy = 0;
}

resetPlayer();

/* ---------- LEVEL DATA ---------- */
function getLevelData(lv) {
  return {
    platforms: [
      {x:0, y:canvas.height-60, w:canvas.width, h:60},
      {x:200, y:canvas.height-150, w:120, h:10},
      {x:420, y:canvas.height-230, w:120, h:10}
    ],
    spikes: [
      {x:320, y:canvas.height-70, w:40, h:10}
    ],
    portal: {x:canvas.width-100, y:canvas.height-260, w:40, h:60}
  };
}

let current = getLevelData(level);

/* ---------- STARS BACKGROUND ---------- */
let stars = [];
for (let i = 0; i < 120; i++) {
  stars.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 2
  });
}

/* ---------- UPDATE ---------- */
function update() {
  if (win) return;

  if (keys["ArrowLeft"]) player.x -= 5;
  if (keys["ArrowRight"]) player.x += 5;

  if (keys["ArrowUp"] && player.onGround) {
    player.vy = jumpPower;
    player.onGround = false;
  }

  player.vy += gravity;
  player.y += player.vy;

  player.onGround = false;

  current.platforms.forEach(p => {
    if (
      player.x < p.x + p.w &&
      player.x + player.w > p.x &&
      player.y < p.y + p.h &&
      player.y + player.h > p.y &&
      player.vy >= 0
    ) {
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  });

  /* Spike death */
  current.spikes.forEach(s => {
    if (
      player.x < s.x + s.w &&
      player.x + player.w > s.x &&
      player.y < s.y + s.h &&
      player.y + player.h > s.y
    ) {
      deaths++;
      document.getElementById("deaths").textContent = deaths;

      if (deaths > 30) {
        level = 1;
        deaths = 0;
        startTime = Date.now();
      }

      document.getElementById("level").textContent = level;
      resetPlayer();
    }
  });

  /* Portal win */
  let g = current.portal;
  if (
    player.x < g.x + g.w &&
    player.x + player.w > g.x &&
    player.y < g.y + g.h &&
    player.y + player.h > g.y
  ) {
    level++;
    document.getElementById("level").textContent = level;

    if (level > 10) {
      win = true;
      return;
    }

    current = getLevelData(level);
    resetPlayer();
  }

  /* Timer */
  let t = ((Date.now() - startTime) / 1000).toFixed(1);
  document.getElementById("time").textContent = t;
}

/* ---------- DRAW ---------- */
function drawPlayer() {
  let x = player.x, y = player.y;

  ctx.fillStyle = "#ffd166"; // head
  ctx.fillRect(x+6, y, 12, 12);

  ctx.fillStyle = "#06d6a0"; // body
  ctx.fillRect(x+4, y+12, 16, 12);

  ctx.fillStyle = "#118ab2"; // legs
  ctx.fillRect(x+4, y+24, 6, 6);
  ctx.fillRect(x+14, y+24, 6, 6);

  ctx.fillStyle = "#ef476f"; // backpack
  ctx.fillRect(x-4, y+12, 6, 10);
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* Stars */
  ctx.fillStyle = "white";
  stars.forEach(s => ctx.fillRect(s.x, s.y, s.r, s.r));

  /* Platforms */
  ctx.fillStyle = "#00d4ff";
  current.platforms.forEach(p => ctx.fillRect(p.x,p.y,p.w,p.h));

  /* Spikes */
  ctx.fillStyle = "red";
  current.spikes.forEach(s => ctx.fillRect(s.x,s.y,s.w,s.h));

  /* Portal */
  ctx.fillStyle = "purple";
  let g = current.portal;
  ctx.fillRect(g.x,g.y,g.w,g.h);

  drawPlayer();

  if (win) {
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.fillText("YOU SAVED TIME! ‚è≥", canvas.width/2 - 180, canvas.height/2);
  }
}

/* ---------- LOOP ---------- */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
