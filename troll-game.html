<!DOCTYPE html>
<html>
<head>
  <title>Time Traveller Troll Game</title>
  <style>
    body { margin:0; overflow:hidden; background:black; color:white; font-family:Arial; }
    #ui { position:fixed; top:10px; left:10px; font-size:18px; }
    canvas { display:block; }
  </style>
</head>
<body>

<div id="ui">
Level: <span id="level">1</span> |
Deaths: <span id="deaths">0</span> |
Time: <span id="time">0.0</span>s
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ---------- GAME STATE ---------- */
let deaths = 0;
let firstDeath = false;
let showText = true;
let laughTimer = 0;
let win = false;

let startTime = Date.now();

let player = { x: 120, y: 0, w: 26, h: 32, vx:0, vy: 0 };
const gravity = 0.7;
const jumpPower = -15;

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function resetPlayer(){
  player.x = 120;
  player.y = canvas.height - 200;
  player.vx = 0;
  player.vy = 0;
}

/* ---------- SOLID PLATFORMS ---------- */
let platforms = [
  {x:80,  y:canvas.height-170, w:160, h:16},
  {x:300, y:canvas.height-260, w:140, h:16},
  {x:520, y:canvas.height-350, w:140, h:16},
  {x:740, y:canvas.height-440, w:140, h:16}
];

let portal = {x:960, y:canvas.height-520, w:60, h:80};

resetPlayer();

/* ---------- COLLISION ---------- */
function rects(a,b){
  return a.x < b.x+b.w &&
         a.x+a.w > b.x &&
         a.y < b.y+b.h &&
         a.y+a.h > b.y;
}

/* ---------- UPDATE ---------- */
function update(){
  if(win) return;

  /* movement */
  player.vx = 0;
  if(keys["ArrowLeft"]) player.vx = -5;
  if(keys["ArrowRight"]) player.vx = 5;

  if(keys["ArrowUp"] && onGround()){
    player.vy = jumpPower;
  }

  player.vy += gravity;

  /* horizontal move */
  player.x += player.vx;
  platforms.forEach(p=>{
    if(rects(player,p)){
      if(player.vx > 0) player.x = p.x - player.w;
      if(player.vx < 0) player.x = p.x + p.w;
    }
  });

  /* vertical move */
  player.y += player.vy;
  platforms.forEach(p=>{
    if(rects(player,p)){
      if(player.vy > 0){ // falling
        player.y = p.y - player.h;
        player.vy = 0;
      }
      if(player.vy < 0){ // hitting bottom
        player.y = p.y + p.h;
        player.vy = 0;
      }
    }
  });

  /* fall death */
  if(player.y > canvas.height){
    die();
  }

  /* portal */
  if(rects(player,portal)){
    win = true;
  }

  /* timer */
  document.getElementById("time").textContent =
    ((Date.now()-startTime)/1000).toFixed(1);

  if(laughTimer > 0) laughTimer--;
}

function onGround(){
  let test = {...player, y: player.y+1};
  return platforms.some(p => rects(test,p));
}

/* ---------- DEATH ---------- */
function die(){
  deaths++;
  document.getElementById("deaths").textContent = deaths;

  if(!firstDeath){
    firstDeath = true;
    showText = true;
  }else{
    showText = false;
    laughTimer = 60;
  }

  resetPlayer();
}

/* ---------- DRAW PORTAL ---------- */
function drawPortal(){
  let g = ctx.createRadialGradient(
    portal.x+portal.w/2, portal.y+portal.h/2, 10,
    portal.x+portal.w/2, portal.y+portal.h/2, 40
  );
  g.addColorStop(0,"#fff");
  g.addColorStop(0.5,"#9b5cff");
  g.addColorStop(1,"#000");

  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.ellipse(
    portal.x+portal.w/2,
    portal.y+portal.h/2,
    30, 45,
    0, 0, Math.PI*2
  );
  ctx.fill();
}

/* ---------- DRAW FACE ---------- */
function drawFace(){
  let x = canvas.width - 150;
  let y = 120;

  let laughing = laughTimer > 0;

  /* eyes */
  ctx.fillStyle = "white";
  if(laughing){
    ctx.fillRect(x-20,y,20,4);
    ctx.fillRect(x+10,y,20,4);
  }else{
    ctx.fillRect(x-20,y-5,12,12);
    ctx.fillRect(x+10,y-5,12,12);
  }

  /* eyebrows */
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(x-22,y-10-(laughing?5:0));
  ctx.lineTo(x-5,y-15-(laughing?5:0));
  ctx.moveTo(x+10,y-15-(laughing?5:0));
  ctx.lineTo(x+27,y-10-(laughing?5:0));
  ctx.stroke();

  /* mouth */
  ctx.beginPath();
  if(laughing){
    ctx.arc(x, y+15, 12, 0, Math.PI);
  }else{
    ctx.arc(x, y+18, 10, Math.PI, 0);
  }
  ctx.stroke();

  /* TEXT */
  ctx.font = "16px Arial";
  ctx.fillStyle = "white";

  if(!firstDeath){
    ctx.fillText("Just a simple space person game", x-120, y+50);
  }else if(showText){
    ctx.fillText("Nah, it is not that much simple but you can do it", x-170, y+50);
  }
}

/* ---------- DRAW PLAYER ---------- */
function drawPlayer(){
  let x=player.x, y=player.y;

  ctx.fillStyle="#ffd166"; ctx.fillRect(x+6,y,12,12);
  ctx.fillStyle="#06d6a0"; ctx.fillRect(x+4,y+12,18,12);
  ctx.fillStyle="#118ab2"; ctx.fillRect(x+4,y+24,6,8);
  ctx.fillRect(x+16,y+24,6,8);
}

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* platforms */
  ctx.fillStyle="#00d4ff";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  drawPortal();
  drawPlayer();
  drawFace();

  if(win){
    ctx.fillStyle="white";
    ctx.font="40px Arial";
    ctx.fillText("YOU ESCAPED TIME ðŸ˜ˆ", canvas.width/2-180, canvas.height/2);
  }
}

/* ---------- LOOP ---------- */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>



</body>
</html>
